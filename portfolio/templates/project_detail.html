{% extends "base.html" %}

{% block content %}
<article class="px-6 max-w-7xl mx-auto py-12" 
         x-data="{ 
            open: false, 
            currentIndex: 0,
            images: [
                {% for item in project.images.all %}'{{ item.image.url }}'{% if not forloop.last %},{% endif %}{% endfor %}
            ],
            next() { this.currentIndex = (this.currentIndex + 1) % this.images.length },
            prev() { this.currentIndex = (this.currentIndex - 1 + this.images.length) % this.images.length }
         }">

    <header class="mb-16">
        <a href="{% url 'projetos' %}" class="text-slate-500 hover:text-cyan-400 text-xs font-bold uppercase tracking-[0.2em] mb-6 inline-block transition-all">‚Üê Voltar</a>
        <h1 class="text-5xl md:text-7xl font-black text-white uppercase tracking-tighter">{{ project.title }}</h1>
        <p class="text-cyan-500 font-bold uppercase text-xs tracking-widest mt-2">{{ project.category.name }}</p>
    </header>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
        {% for item in project.images.all %}
            <div class="group relative aspect-square overflow-hidden rounded-2xl bg-[#0a0a0a] border border-white/5 cursor-pointer"
                 @click="open = true; currentIndex = {{ forloop.counter0 }}">
                
                <img src="{{ item.image.url }}" 
                     alt="Frame do projeto {{ project.title }}" 
                     class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                
                <div class="absolute inset-0 bg-cyan-500/10 backdrop-blur-[2px] opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                    <div class="bg-white text-black p-3 rounded-full shadow-xl transform translate-y-4 group-hover:translate-y-0 transition-transform">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="col-span-full py-20 text-center border-2 border-dashed border-white/10 rounded-3xl">
                <p class="text-slate-500 italic">Nenhuma imagem para exibir neste grid.</p>
            </div>
        {% endfor %}
    </div>
<template x-teleport="body">
    <div x-show="open" 
         class="fixed inset-0 z-[999] bg-black/60 backdrop-blur-xl flex flex-col"
         x-transition:enter="transition duration-300 ease-out"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition duration-200 ease-in"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         @keydown.right.window="next()"
         @keydown.left.window="prev()"
         @keydown.escape.window="open = false"
         style="display: none;">
        
        <button @click="open = false" class="absolute top-6 right-6 text-white/50 hover:text-white z-50 p-4 transition-colors">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M6 18L18 6M6 6l12 12" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>

        <div class="flex-1 flex items-center justify-center p-4 relative">
            <button @click="prev()" class="absolute left-4 md:left-10 text-white/40 hover:text-white transition-all transform hover:scale-110">
                <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M15 19l-7-7 7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>

            <img :src="images[currentIndex]" 
                 class="max-w-full max-h-[85vh] object-contain rounded-lg shadow-[0_20px_50px_rgba(0,0,0,0.5)] border border-white/10"
                 x-transition:enter="transition duration-500 delay-100"
                 x-transition:enter-start="scale-95 opacity-0">

            <button @click="next()" class="absolute right-4 md:right-10 text-white/40 hover:text-white transition-all transform hover:scale-110">
                <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M9 5l7 7-7 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
        
        <div class="pb-8 text-center">
            <div class="inline-block px-4 py-1 bg-white/5 backdrop-blur-md rounded-full border border-white/10">
                <p class="text-slate-400 text-[10px] font-mono uppercase tracking-[0.3em]">
                    <span class="text-white font-bold" x-text="currentIndex + 1"></span> / <span x-text="images.length"></span>
                </p>
            </div>
        </div>
    </div>
</template>

</article>
{% endblock %}
{% comment %}
    <h1>{{ project.title }}</h1>
<p>Categoria: {{ project.category.name }}</p>

<div class="gallery">
    {% for image in project.images.all %}
        <img src="{{ image.image.url }}" style="width:300px;">
    {% endfor %}
</div>

<a href="{% url 'index' %}">Voltar</a>
{% endcomment %}